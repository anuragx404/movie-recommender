<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Movie Recommender</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 20px; display: flex; justify-content: center; }
    .container { max-width: 900px; width: 100%; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; flex-wrap: wrap; gap: 30px; }
    .control-panel { flex: 2 1 500px; display: flex; flex-direction: column; }
    h1 { margin-top: 0; margin-bottom: 25px; color: #333; text-align: center; }
    label { font-weight: bold; margin-bottom: 8px; color: #555; }
    .input-wrapper { position: relative; width: 100%; }
    #movie-input { width: 100%; padding: 12px 14px; font-size: 1rem; border-radius: 6px; border: 1.5px solid #ccc; box-sizing: border-box; }
    #suggestions { border: 1.5px solid #ccc; border-top: none; border-radius: 0 0 6px 6px; max-width: 100%; background: #fff; position: absolute; top: 100%; left: 0; box-sizing: border-box; max-height: 180px; overflow-y: auto; z-index: 99; display: none; }
    #suggestions div { padding: 12px 16px; cursor: pointer; }
    #suggestions div:hover { background-color: #f0f0f0; }
    button#recommend-btn { padding: 14px; background-color: #007bff; border: none; border-radius: 6px; font-size: 1.1rem; font-weight: bold; cursor: pointer; color: white; margin-top: 20px; }
    .movie-list { flex: 1 1 250px; max-height: 600px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
    .movie-list h2 { margin-top: 0; text-align: center; }
    .movie-list ul { list-style: none; padding-left: 0; margin: 0; }
    .movie-list li { padding: 4px 2px; border-bottom: 1px solid #eee; cursor: pointer; }
    #recommendations-container { display: none; margin-top: 25px; padding-top: 20px; border-top: 1.5px solid #eee; }
    #recommendation-title { font-size: 1.3rem; color: #333; margin-top: 0; margin-bottom: 15px; }
    #recommendation-list { list-style: none; padding-left: 0; margin: 0; }
    #recommendation-list li { background: #e9ecef; margin-bottom: 10px; padding: 12px 15px; border-radius: 6px; }
  </style>
</head>
<body>

  <div class="container">
    <div class="control-panel">
      <h1>Movie Recommender</h1>
      <label for="movie-input">Type a movie:</label>
      <div class="input-wrapper">
        <input type="text" id="movie-input" autocomplete="off" placeholder="e.g., The Dark Knight" />
        <div id="suggestions"></div>
      </div>
      <button id="recommend-btn">Recommend</button>
      <div id="recommendations-container">
        <h2 id="recommendation-title"></h2>
        <ul id="recommendation-list"></ul>
      </div>
    </div>
    <div class="movie-list">
      <h2>All Movies</h2>
      <ul id="all-movies-list">
        {% for movie in movies %}
        <li class="movie-item">{{ movie }}</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <script>
    const recommendBtn = document.getElementById('recommend-btn');
    const recommendationsContainer = document.getElementById('recommendations-container');
    const recommendationTitle = document.getElementById('recommendation-title');
    const recommendationList = document.getElementById('recommendation-list');
    const movieInput = document.getElementById('movie-input');
    const suggestions = document.getElementById('suggestions');
    const allMoviesList = document.getElementById('all-movies-list');
    const allMovies = [{% for movie in movies %}"{{ movie }}",{% endfor %}];

    function getRecommendations(movieName) {
      recommendationsContainer.style.display = 'block';
      recommendationTitle.textContent = `Recommendations for "${movieName}"`;
      recommendationList.innerHTML = '<li>Loading...</li>';
      fetch('/recommend', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ movie: movieName })
      })
      .then(response => response.json())
      .then(data => {
        recommendationList.innerHTML = '';
        if (data.recommendations && data.recommendations.length > 0) {
            data.recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationList.appendChild(li);
            });
        } else {
            recommendationList.innerHTML = '<li>No recommendations found for this movie.</li>';
        }
      });
    }

    recommendBtn.addEventListener('click', () => {
      const movie = movieInput.value.trim();
      if (movie) getRecommendations(movie);
    });

    allMoviesList.addEventListener('click', (event) => {
      if (event.target.tagName === 'LI') {
        const selectedMovie = event.target.textContent.trim();
        movieInput.value = selectedMovie;
        getRecommendations(selectedMovie);
      }
    });

    movieInput.addEventListener('input', () => {
      const query = movieInput.value.trim().toLowerCase();
      if (!query) {
        suggestions.style.display = 'none';
        return;
      }
      const filtered = allMovies.filter(m => m.toLowerCase().includes(query)).slice(0, 5);
      suggestions.innerHTML = '';
      filtered.forEach(m => {
        const div = document.createElement('div');
        div.textContent = m;
        div.addEventListener('click', () => {
          movieInput.value = m;
          suggestions.style.display = 'none';
        });
        suggestions.appendChild(div);
      });
      suggestions.style.display = filtered.length > 0 ? 'block' : 'none';
    });

    document.addEventListener('click', e => {
      if (e.target !== movieInput) {
        suggestions.style.display = 'none';
      }
    });
  </script>

</body>
</html>